<!DOCTYPE html>  <html> <head>   <title>url.google-maps-utils.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="script.html">                 script.js               </a>                                           <a class="source" href="url.google-maps-utils.html">                 url.google-maps-utils.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               url.google-maps-utils.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Google Mixins made by Uros Lates.
 This are helpers that can be used with Google Maps services.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">UrlGoogleMixin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
<span class="nx">UrlGoogleMixin</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Gets google address<em>components property (retured from google components) as argument and returns serialized address
Serialized address contains json representation of an address.
Usefull if you have address form with feilds Country/Region/City... and all are autocompleteable.
Then if user starts typning street into box and selects one that google Autocomplete retuns, we can prepopulate remaining fields with the rest of the data.
 Or we can then if user has filled in country first append each of the remaining address inputs with "country.short</em>name". That way we reduce search results to that specific country only.
 Demo usage can be found within "demo" directory -> "index.html" page.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">serializeAddress</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">addressComponents</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Address JSON object defaults</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">country</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">region</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">city</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">zip_code</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">street</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">street_number</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>TODO: Ensure that administrative<em>area</em>level<em>N is ordered witn N ad ASC!!
quicksort looping administrative</em>area<em>level</em>N to order it in ASC...</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Important: Expects that administrative<em>area</em>level_N is ordered witn N ad ASC!!</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">component</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">addressComponents</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">component</span> <span class="o">=</span> <span class="nx">addressComponents</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">component</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;types&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">type</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">types</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">type</span><span class="p">){</span>
            <span class="k">case</span> <span class="s1">&#39;country&#39;</span><span class="o">:</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">country</span> <span class="o">=</span> <span class="nx">component</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;locality&#39;</span><span class="o">:</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">city</span> <span class="o">=</span> <span class="nx">component</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;administrative_area_level_1&#39;</span><span class="o">:</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">region</span> <span class="o">=</span> <span class="nx">component</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;administrative_area_level_2&#39;</span><span class="o">:</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">region</span> <span class="o">=</span> <span class="nx">component</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;route&#39;</span><span class="o">:</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">street</span> <span class="o">=</span> <span class="nx">component</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;street_number&#39;</span><span class="o">:</span>
              <span class="nx">result</span><span class="p">.</span><span class="nx">street_number</span> <span class="o">=</span> <span class="nx">component</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>
 
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Mixin that is used to update Address Forms (complex set of fields representing addresses).
Accepts JSON config object that represents a map of html input fields that represent address</p>

<pre><code>addressFieldsConfig - is expected to have following structure:
var addressFieldsConfig = {
    'country': document.getElementById('id_country'),
    'region': document.getElementById('id_region'),
    'city': document.getElementById('id_city'), 
    'zip': document.getElementById('id_zip_code'),
    'street': document.getElementById('id_street')
}   
</code></pre>

<p>NOTE: Its very important that above JSON has exactly the same keys as specified above.
    Reason: Those keys have to correspond to keys consumed by UrlGoogleMixin mixin.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">UrlAddressFormMixin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">addressFieldsConfig</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Register of Form Fields that need to be handled</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">addressFieldsConifg</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setAddressFormFields</span><span class="p">(</span><span class="nx">addressFieldsConfig</span> <span class="o">||</span> <span class="p">{</span>
            <span class="s1">&#39;country&#39;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="s1">&#39;region&#39;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="s1">&#39;zip_code&#39;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="s1">&#39;city&#39;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="s1">&#39;street&#39;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="s1">&#39;street_number&#39;</span><span class="o">:</span> <span class="kc">null</span>
          <span class="p">});</span>
<span class="p">}</span>
<span class="nx">UrlAddressFormMixin</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Setter method that is used to modify "addressFieldsConfig"  values.
IMPORTANT: It is expected that value is an HTML element (get it via document.getElementById('..'))</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">addressFieldsConifg</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> 
      <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;You are trying to set a property &lt;addressFieldsConfig&gt;.&#39;</span><span class="o">+</span><span class="nx">key</span><span class="o">+</span><span class="s1">&#39; which isn\&#39;t supported!&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>TODO: Check if value is of type HTMLNode            </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">addressFieldsConifg</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>For chaining</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Setter method - settings Address Form Fields configuration object to manipulate on.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">setAddressFormFields</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">addressFormFieldsConfig</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">aCmp</span> <span class="k">in</span> <span class="nx">addressFormFieldsConfig</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">aCmp</span><span class="p">,</span> <span class="nx">addressFormFieldsConfig</span><span class="p">[</span><span class="nx">aCmp</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Populates "Address Form Fields" with the "address" provided.
If addressFormFieldsConfig is not provided it uses default one.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">setAddressFormFieldsToAddress</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">addressFormFieldsConfig</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>addressFields - maps inputs to keys that serializeAddress resulting JSON reckognizes!
Set this.addressFieldsConifg to second argument if provided (important if CMP gets instaniated without form fields configuration provided)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">addressFields</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addressFieldsConifg</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">addressFormFieldsConfig</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">addressFieldsConifg</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">field</span> <span class="k">in</span> <span class="nx">addressFields</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Validate if addressFields is set correctly initially</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">addressFields</span><span class="p">[</span><span class="nx">field</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;setAddressFormFieldsToAddress(...): &lt;addressFields&gt; are not set correctly! This should contain reference to all the form fields!&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="k">if</span><span class="p">(</span><span class="nx">address</span><span class="p">[</span><span class="nx">field</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">addressFields</span><span class="p">[</span><span class="nx">field</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">address</span><span class="p">[</span><span class="nx">field</span><span class="p">].</span><span class="nx">long_name</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Helper method to generate full address based on current Address Form fields values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">generateFullAddress</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">full_addr_arr</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(),</span>
        <span class="nx">afc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addressFieldsConifg</span><span class="p">,</span>
        <span class="nx">country</span> <span class="o">=</span> <span class="nx">afc</span><span class="p">.</span><span class="nx">country</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="nx">region</span> <span class="o">=</span> <span class="nx">afc</span><span class="p">.</span><span class="nx">region</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="nx">city</span> <span class="o">=</span> <span class="nx">afc</span><span class="p">.</span><span class="nx">city</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="nx">zip_code</span> <span class="o">=</span> <span class="nx">afc</span><span class="p">.</span><span class="nx">zip_code</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="nx">street</span> <span class="o">=</span> <span class="nx">afc</span><span class="p">.</span><span class="nx">street</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="nx">street_number</span> <span class="o">=</span> <span class="nx">afc</span><span class="p">.</span><span class="nx">street_number</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">street</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>           <span class="nx">full_addr_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">street</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">street_number</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>    <span class="nx">full_addr_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">street_number</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">city</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>             <span class="nx">full_addr_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">city</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">region</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>           <span class="nx">full_addr_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">region</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">country</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>          <span class="nx">full_addr_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">country</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">zip_code</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>         <span class="nx">full_addr_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">zip_code</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">full_addr_arr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 